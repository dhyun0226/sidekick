# OAuth 전용 로그인 가이드

> 이메일/비밀번호 인증은 제거되었습니다. 구글/카카오 소셜 로그인만 지원합니다.

---

## 왜 OAuth만 사용하나요?

### ✅ 장점

1. **사용자 편의성**
   - 별도 비밀번호 기억 불필요
   - 3초 만에 가입/로그인
   - 이미 사용 중인 계정으로 간편하게 시작

2. **보안**
   - 비밀번호 저장/관리 불필요 → 보안 위험 감소
   - 구글/카카오의 강력한 보안 체계 활용
   - 2FA(이중 인증) 자동 지원 (OAuth 프로바이더 설정 시)

3. **개발/운영 편의성**
   - 비밀번호 재설정 기능 불필요
   - 이메일 인증 서버 불필요
   - SMTP 설정 불필요
   - 보안 관련 법적 책임 감소

4. **사용자 정보 품질**
   - 실명 인증된 계정 (구글/카카오)
   - 정확한 이메일 주소 보장
   - 프로필 사진 자동 제공

### ❌ 이메일 로그인의 단점

- 비밀번호 찾기/재설정 기능 구현 필요
- SMTP 서버 설정 및 관리
- 이메일 인증 로직 구현
- 스팸 가입 방지 (reCAPTCHA 등)
- 비밀번호 보안 정책 관리 (해싱, 복잡도 검증 등)
- 개인정보 보호법 준수 (비밀번호 저장)

---

## 현재 로그인 화면

### UI 구성

```
┌────────────────────────────────────────┐
│              📚 (로고)                  │
│            Sidekick                     │
│       함께 읽는 즐거움, 사이드킥         │
│                                         │
│  ┌────────────────────────────────┐    │
│  │  🔵 구글로 시작하기             │    │
│  └────────────────────────────────┘    │
│                                         │
│  ┌────────────────────────────────┐    │
│  │  💬 카카오로 시작하기           │    │
│  └────────────────────────────────┘    │
│                                         │
│  ╔════════════════════════════════╗    │
│  ║ ℹ️ 간편하고 안전한 소셜 로그인  ║    │
│  ║ 구글 또는 카카오 계정으로       ║    │
│  ║ 3초 만에 시작하세요.            ║    │
│  ╚════════════════════════════════╝    │
│                                         │
│  ✅ 그룹과 함께 책 읽기              │
│  ✅ 위치별 댓글 및 토론              │
│  ✅ 스포일러 자동 방지                │
│                                         │
│  서비스 이용약관 | 개인정보처리방침    │
└────────────────────────────────────────┘
```

### 개선 사항

1. **더 깔끔한 디자인**
   - 이메일 입력란 제거 → 화면이 간결함
   - OAuth 버튼에 집중
   - 버튼 크기 증가로 모바일 터치 용이

2. **추가 정보 제공**
   - "간편하고 안전한 소셜 로그인" 안내 박스
   - 주요 기능 3가지 체크리스트
   - 로그인 중 상태 표시 (각 버튼별)

3. **애니메이션**
   - fadeInUp 애니메이션 (순차적 등장)
   - 호버 효과 (scale-[1.02])
   - 로딩 중 버튼 비활성화

---

## 로그인 플로우

### 전체 플로우

```
┌───────────────────┐
│  로그인 페이지    │ /login
│  - 구글 버튼      │
│  - 카카오 버튼    │
└─────────┬─────────┘
          │
          │ 버튼 클릭
          │
          ▼
┌───────────────────┐
│ OAuth 프로바이더  │
│ 인증 화면         │ (Google/Kakao)
│ - 계정 선택       │
│ - 권한 동의       │
└─────────┬─────────┘
          │
          │ 인증 완료
          │
          ▼
┌───────────────────┐
│ /auth/callback    │ ← Supabase가 토큰 처리
│ (로딩 화면)       │
└─────────┬─────────┘
          │
          │ users 테이블 조회
          │
      ┌───▼───┐
      │프로필?│
      └───┬───┘
          │
     ┌────┴────┐
  없음│         │있음
     │         │
     ▼         ▼
┌──────────┐ ┌────┐
│온보딩    │ │홈  │
│페이지    │ │화면│
│- 닉네임  │ │    │
│- 아바타  │ │    │
└────┬─────┘ └────┘
     │
     │ 완료
     │
     ▼
   ┌────┐
   │홈  │
   │화면│
   └────┘
```

### 신규 사용자 (처음 로그인)

1. "구글로 시작하기" 클릭
2. 구글 계정 선택 및 권한 동의
3. `/auth/callback` 페이지 (자동)
4. users 테이블 조회 → **프로필 없음**
5. `/onboarding` 페이지로 이동
6. OAuth 제공 정보 자동 채움:
   - 닉네임: 구글 계정 이름
   - 아바타: 구글 프로필 사진
7. 수정 후 "시작하기" 클릭
8. users 테이블에 프로필 INSERT
9. 홈(`/`)으로 이동

### 기존 사용자 (재로그인)

1. "카카오로 시작하기" 클릭
2. 카카오 인증 (자동 - 이미 로그인된 경우)
3. `/auth/callback` 페이지 (자동)
4. users 테이블 조회 → **프로필 있음**
5. 홈(`/`)으로 바로 이동

### 자동 로그인

- 브라우저 새로고침 → 자동 로그인 유지
- 새 탭 열기 → 자동 로그인 유지
- 브라우저 닫고 다시 열기 → 7일간 자동 로그인 유지

---

## 코드 구조

### 1. `pages/login.vue`

**제거된 항목:**
- ❌ 이메일 입력 필드
- ❌ 비밀번호 입력 필드
- ❌ 닉네임 입력 필드 (회원가입 시)
- ❌ "또는 이메일로 계속하기" 구분선
- ❌ 이메일 로그인/회원가입 토글
- ❌ handleSubmit() 함수

**추가된 항목:**
- ✅ 간편 로그인 안내 박스
- ✅ 주요 기능 체크리스트
- ✅ 로딩 상태별 텍스트 ("로그인 중...")
- ✅ fadeInUp 애니메이션
- ✅ 이용약관/개인정보처리방침 링크

**핵심 코드:**
```vue
<button @click="signInWithOAuth('google')" :disabled="loading">
  <!-- 구글 로고 SVG -->
  <span v-if="loading === 'google'">로그인 중...</span>
  <span v-else>구글로 시작하기</span>
</button>
```

### 2. `stores/user.ts`

**제거된 메서드:**
- ❌ `signIn(email, password)` - 이메일 로그인
- ❌ `signUp(email, password, nickname)` - 이메일 회원가입

**유지된 메서드:**
- ✅ `fetchProfile()` - 프로필 조회
- ✅ `signOut()` - 로그아웃
- ✅ `signInWithOAuth(provider)` - OAuth 로그인
- ✅ `updateProfile(nickname, avatarUrl?)` - 프로필 수정

**스토어 반환값:**
```typescript
return {
  user,              // 현재 인증된 사용자
  profile,           // 사용자 프로필 (users 테이블)
  fetchProfile,      // 프로필 조회
  signOut,           // 로그아웃
  signInWithOAuth,   // OAuth 로그인 (구글/카카오)
  updateProfile      // 프로필 업데이트
}
```

### 3. `pages/auth/callback.vue`

변경 사항 없음 - OAuth 전용이므로 이미 최적화됨

### 4. `pages/onboarding.vue`

변경 사항 없음 - OAuth 정보 자동 채우기 이미 구현됨

---

## 설정 가이드

### Supabase 설정

#### 1. 이메일 인증 비활성화 (선택 사항)

Supabase Dashboard → Authentication → Providers:
- Email → **Disable** 체크

이렇게 하면 이메일 인증 시도 자체를 차단합니다.

#### 2. OAuth 프로바이더만 활성화

- Google → **Enable** ✅
- Kakao → **Enable** ✅
- 나머지 프로바이더 → Disable

### 데이터베이스

변경 사항 없음 - users 테이블은 OAuth도 동일하게 사용

---

## FAQ

### Q1: 나중에 이메일 로그인을 다시 추가할 수 있나요?

**A:** 가능합니다. 코드만 복원하면 됩니다:

```typescript
// stores/user.ts
const signIn = async (email: string, password: string) => {
  const client = getClient()
  const { error } = await client.auth.signInWithPassword({
    email, password
  })
  if (error) throw error
  await fetchProfile()
  getRouter().push('/')
}
```

하지만 권장하지 않습니다. OAuth만으로도 충분합니다.

### Q2: 구글/카카오 계정이 없는 사람은 어떡하나요?

**A:**
- **구글:** 무료로 Gmail 계정 생성 가능 (전 세계 대부분 사용)
- **카카오:** 한국 사용자 대부분 보유

실제로 이메일 로그인을 원하는 사용자는 극히 적습니다.

### Q3: 보안은 괜찮나요?

**A:** 오히려 더 안전합니다:
- 구글/카카오의 엔터프라이즈급 보안 체계
- 2단계 인증 지원 (프로바이더 설정)
- 비밀번호 유출 위험 0% (저장 안 함)

### Q4: 사용자가 계정을 바꾸면 어떻게 되나요?

**A:**
- 구글 계정 A로 가입 → ID: abc123
- 구글 계정 B로 로그인 → ID: def456 (새 계정)

각 OAuth 계정은 고유 ID를 가지므로 완전히 별도 계정입니다.

### Q5: 로그아웃 후 다시 로그인하면?

**A:**
1. "구글로 시작하기" 클릭
2. 이미 인증된 경우 → **자동으로 바로 로그인** (1초 이내)
3. 인증 안 된 경우 → 계정 선택 화면

---

## 사용자 통계 (참고)

실제 웹 서비스에서의 로그인 방식 선택률:

```
OAuth (소셜 로그인): 85-90%
├─ 구글: 45-50%
├─ 카카오/네이버: 30-35% (한국)
└─ 페이스북/애플: 10-15%

이메일/비밀번호: 10-15%
└─ 주로 B2B, 엔터프라이즈, 보안 중시 서비스
```

**결론:** 일반 소비자 대상 서비스는 OAuth만으로 충분합니다!

---

## 추가 OAuth 프로바이더 (선택 사항)

필요 시 추가 가능한 프로바이더:

### 네이버 (한국)

```typescript
// stores/user.ts
type Provider = 'google' | 'kakao' | 'naver'

// Supabase Dashboard → Authentication → Providers → Naver
// Client ID, Secret 입력
```

### 애플 (Apple Sign In)

```typescript
// stores/user.ts
type Provider = 'google' | 'kakao' | 'apple'

// iOS/macOS 사용자에게 유용
```

### GitHub (개발자 커뮤니티)

```typescript
// stores/user.ts
type Provider = 'google' | 'kakao' | 'github'

// 개발자 대상 서비스에 적합
```

---

## 마이그레이션 체크리스트

기존 이메일 사용자가 있는 경우:

- [ ] Supabase Dashboard → Authentication → Users 확인
- [ ] 이메일 가입 사용자 있는지 체크
- [ ] 필요 시 공지사항 발송 ("OAuth 로그인으로 전환됩니다")
- [ ] 유예 기간 설정 (예: 1개월)
- [ ] 이메일 로그인 비활성화
- [ ] 사용자에게 OAuth 재가입 안내

**참고:** 현재 Sidekick은 MVP 단계이므로 기존 사용자가 없을 가능성이 높습니다.

---

## 테스트 시나리오

### 신규 사용자

1. ✅ 구글 로그인 → 온보딩 → 홈
2. ✅ 카카오 로그인 → 온보딩 → 홈
3. ✅ 온보딩에서 OAuth 정보 자동 채워짐
4. ✅ 온보딩에서 닉네임 수정 가능
5. ✅ 온보딩에서 아바타 변경 가능

### 기존 사용자

1. ✅ 구글 로그인 → 바로 홈
2. ✅ 카카오 로그인 → 바로 홈
3. ✅ 새로고침 → 로그인 유지
4. ✅ 브라우저 재시작 → 로그인 유지

### 에러 케이스

1. ✅ OAuth 취소 → 로그인 페이지 복귀
2. ✅ 네트워크 오류 → 에러 메시지 표시
3. ✅ 프로필 생성 실패 → 온보딩 재시도

---

## 결론

**OAuth 전용 로그인의 장점:**

✅ 사용자 경험 개선 (3초 가입)
✅ 보안 강화 (비밀번호 불필요)
✅ 개발/운영 비용 절감 (이메일 서버 불필요)
✅ 법적 책임 감소 (비밀번호 저장 안 함)
✅ 사용자 정보 품질 향상 (실명 인증)

**이메일 로그인은 필요 없습니다!** 🎉

---

**문서 버전:** 1.0.0
**최종 수정:** 2024-12-08
**작성자:** Sidekick Development Team
